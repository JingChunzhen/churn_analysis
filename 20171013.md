# 基于XGBoost和随机森林的流失分析

<center>景春臻 levelup.ai 2017.10.13</center>

## 实验目的

以自然天为单位，以第一自然天数据中的动作，体力，钻石，金币等所有信息来预测第二自然天玩家是否会流失，将数据以天为单位进行分割以后，
分析流失用户，次流用户，三流用户等流失信息


## 数据预处理以及实验流程
 
* 将数据以自然天进行分割，以天为单位统计所有用户的金币，等级，黑钻等的获取速度，以及动作种类数和玩的总时长
* 将数据以自然天进行分割，以天为单位获得该用户在该天的动作序列，在动作中，统计操作该动作的玩家数，剔除操作树较少的动作获取新的动作序列，并生成TF-IDF矩阵，由XGBoost提取关键的动作信息
* 将第二步所得的动作信息生成的TF-IDF矩阵结合第一步所得到的特征再次使用XGBoost进行分类
* 数据不平衡问题的处理：在第一自然天中游戏玩家中大约会有60%会流失，对非流失玩家进行采样，得到的流失玩家和非流失玩家的比例为7348:7142，比例大约为1:1， 在第二自然天中游戏玩家大约有50%会流失，所以不需要进行采样，在第三自然天中，由于数据本身的原因（第四天的数据只统计了很小的时间段内），未进行分析

算法流程图如下

<center>![ ](/home/jingchunzhen/Desktop/基本流程图.png  "实验流程图")</center>

## 实验前思考的问题

* 在提取关键动作信息时，使用XGBoost所提取的动作需要进行验证，如使用多个模型如随机森林或者时序关联规则联合验证
* 如何评判一个模型的效果，如果只用一个模型是否具备说服力

## 和之前实验的比较

* 相比2017.9.30的实验，在使用以自然天分割之后得到的动作信息进行分类，由XGBoost得到的在测试集上的分类准确率为74%，相比之前的86%说明的确有数据泄露问题，在之前生成的TF-IDF矩阵中，由于未按照天进行分割，
* 相比2017.9.30的实验，本实验除动作信息以外，综合考虑了其余的特征，包括金币，黑钻等的获取速度，等级晋升速度，动作之间的连贯性（动作之间的时间间隔），玩家在一个自然天中所玩的动作种类和玩的总时间等信息, 此外将数据以自然天进行分割，以第一自然天的所有数据来预测第二自然天玩家的流失，相比之前的实验最大幅度的降低了数据泄露问题
* 此外，本次实验所结合的动作信息剔除了操作数量较少的动作，并使用XGBoost提取关键动作，结合上述特征，再次进行训练

## 实验的进展
* 目前得到了由XGBoost获取到的关键动作信息，其余的特征提取正在逐步完善中
* 将数据以天为单位进行分割，进行分类，得到的准确率和之前的实验相差较大，验证了之前所认为的数据泄露问题